!function($,doc){NUI=function(){return NUI.init()},window.NUI=NUI,NUI.doc=doc,NUI.noop={};try{NUI.$=$}catch(e){throw new Error("jQuery not undefine")}NUI.prototype={init:function(){return this}},NUI.getUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,a="x"==t?e:3&e|8;return a.toString(16)})},NUI.trim=function(t){var t=t||"";return t.replace(/(^\s*)|(\s*$)/g,"")},NUI.ajax=function(t,e,a){var a=a||{};return $.ajax({type:"POST",url:t,data:a,async:e})},NUI.NUISelect=function(t,e){var a={initValue:"-- 请选择 --",width:100,data:[],ID:"ID",valueColor:"#000",value:"text",beforeSelect:function(){},onSelect:function(){},afterSelect:function(){}},i=NUI.$.extend({},a,e),n=function(e){return e.create=function(){var e=[];e.push('<div class="NUISelectCont" style="width:'+i.width+'px;background:#fff;">'),i.data.length<=0&&e.push('<p class="NUISelectVal SysTxtEll" style="color:'+i.valueColor+';">请选择</p>');for(var a=0,n=i.data.length;n>a;a++){if(i.data[a].active){e.push('<p class="NUISelectVal SysTxtEll" style="color:'+i.valueColor+';">'+i.data[a][i.value]+"</p>");break}a==n-1&&e.push('<p class="NUISelectVal SysTxtEll">请选择</p>')}e.push('<span class="NUISelectIco"> <i class="NUISelectDown"></i></span>'),e.push('<ul class="NUISelectList SysHide">');for(var s,l=0,r=i.data.length;r>l;l++)s=i.data[l],s.active?e.push('<li data-id="'+s[i.ID]+'" class="active">'+s[i.value]+"</li>"):e.push('<li data-id="'+s[i.ID]+'">'+s[i.value]+"</li>");e.push("</ul></div>"),t.prepend(e.join(""))},e.event=function(){t.click(function(){var t=$(this).find("i"),e=$(this).find(".NUISelectList");return t.hasClass("NUISelectDown")?t.removeClass("NUISelectDown").addClass("NUISelectUp"):t.removeClass("NUISelectUp").addClass("NUISelectDown"),e.hasClass("SysHide")?e.removeClass("SysHide"):e.addClass("SysHide"),$(".NUISelectList").not(e).addClass("SysHide"),!1}),t.on("click","li",function(t){i.beforeSelect&&i.beforeSelect($(this));var a=$(this).text(),n=$(this).index(),s=$(this).parent().prev().find("i");return a&&$(this).parent().parent().children().eq(0).text(a),i.onSelect&&i.onSelect($(this)),$(this).addClass("active").siblings().removeClass("active"),s.removeClass("NUISelectUp").addClass("NUISelectDown"),$(this).parent().addClass("SysHide"),e.uuid=$(this).attr("data-id"),e.text=$(this).text(),$(this).parent().parent().next().children().eq(n).attr("selected",!0).siblings().attr("selected",!1),i.afterSelect&&i.afterSelect($(this)),!1}),$(document).on("click",function(){var t=$(this).find("NUISelectIco").find("i");$(".NUISelectList").addClass("SysHide"),t.removeClass("NUISelectUp").addClass("NUISelectDown")})},e.destory=function(){t.empty(),t.data("NUISelect",null)},e.setData=function(t){},e.getData=function(){var t={};return t[i.ID]=e.uuid,t[i.value]=e.text,t},e.init=function(){e.create(),e.event()}(),e}(n||{});t.data("NUISelect",n)},NUI.NUITree=$.fn.zTree,NUI.NUIPages=function(t,e,a,i){function n(){return Math.ceil(e/a.page_size)}function s(){var t=Math.ceil(a.num_display/2),e=n(),i=e-a.num_display,s=o>t?Math.max(Math.min(o-t,i),0):0,l=o>t?Math.min(o+t,e):Math.min(a.num_display,e);return[s,l]}function l(t,e){o=t,r();var i=a.callback(t,c);return i||(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0),i}function r(){c.empty();var t=s(),e=n(),i=function(t){return function(e){return l(t,e)}},r=NUI.$("<a>首页</a>").bind("click",i(0)).attr("href",a.link_to.replace(/__id__/,0));c.append(r);var d=function(t,n){if(t=0>t?0:e>t?t:e-1,n=NUI.$.extend({text:t+1,classes:""},n||{}),t==o)var s=NUI.$("<span class='current'>"+n.text+"</span>");else var s=NUI.$("<a>"+n.text+"</a>").bind("click",i(t)).attr("href",a.link_to.replace(/__id__/,t));n.classes&&s.addClass(n.classes),c.append(s)};if(a.prev_text&&(o>0||a.prev_show_always)&&d(o-1,{text:a.prev_text,classes:"prev"}),t[0]>0&&a.num_edge_entries>0){for(var p=Math.min(a.num_edge_entries,t[0]),h=0;p>h;h++)d(h);a.num_edge_entries<t[0]&&a.ellipse_text&&NUI.$("<span>"+a.ellipse_text+"</span>").appendTo(c)}for(var h=t[0];h<t[1];h++)d(h);if(t[1]<e&&a.num_edge_entries>0){e-a.num_edge_entries>t[1]&&a.ellipse_text&&NUI.$("<span>"+a.ellipse_text+"</span>").appendTo(c);for(var u=Math.max(e-a.num_edge_entries,t[1]),h=u;e>h;h++)d(h)}a.next_text&&(e-1>o||a.next_show_always)&&d(o+1,{text:a.next_text,classes:"next"});var f=NUI.$("<a>尾页</a>").bind("click",i(e-1)).attr("href",a.link_to.replace(/__id__/,e-1));c.append(f)}a=NUI.$.extend({page_size:10,num_display:10,current_page:0,num_edge_entries:1,link_to:"#",pageSizeField:"pageSize",pageIndexField:"pageIndex",prev_text:"<<",next_text:">>",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,callback:function(){},success:function(t){},error:function(t){}},a||{}),a.callback=function(e,n){var s={};s[a.pageSizeField]=a.page_size,e+=1,s[a.pageIndexField]=e,NUI.$.ajax({type:"POST",url:i,data:s,dataType:"json",async:!1,success:function(n){a.current_page=e<Math.ceil(n.total/a.page_size)?e-1:Math.ceil(n.total/a.page_size)-1,NUI.NUIPages(t,n.total,a,i),a.success(n,e)},error:function(t){a.error(t)}})};var o=a.current_page;e=!e||0>e?1:e,a.page_size=!a.page_size||a.page_size<0?1:a.page_size;var c=t;this.selectPage=function(t){l(t)},this.prevPage=function(){return o>0?(l(o-1),!0):!1},this.nextPage=function(){return o<n()-1?(l(o+1),!0):!1},r()},NUI.NUIArtTips=NUI.NUIAtrSubmit=function(t){var t=t||{},e={};e.fixed=!0,e=$.extend(e,t),e.lock=!0,art.dialog(e)},NUI.NUIAtrIframe=function(t){var t=t||{},e={};e.width="800px",e.height="400px",e.fixed=!0,e=$.extend(e,t),e.lock=!0,e.content='<iframe width="100%" height="100%" frameborder="0" src="'+e.content+'"></iframe>',art.dialog(e)};var NUI=NUI||{};NUI.NUIArtTips=NUI.NUIAtrSubmit=function(t){var t=t||{},e={};e.fixed=!0,e=$.extend(e,t),e.lock=!0,e.drag=!1,art.dialog(e)},NUI.NUIAtrIframe=function(t){var t=t||{},e={};e.width="800px",e.height="400px",e.fixed=!0,e=$.extend(e,t),e.lock=!0,e.content='<iframe width="100%" height="100%" frameborder="0" src="'+e.content+'"></iframe>',art.dialog(e)},NUI.NUITab=function(){$(document).on("click",".NUITabAction li",function(){var t=$(this).index(),e=$(this).parent().next().children();$(this).addClass("active").siblings().removeClass("active"),e.eq(t).show().siblings().hide()})}(),$(function(){function Table(t){this.ele=t,this.options={url:this.ele.attr("data-url"),oTbody:this.ele.find("tbody"),aTh:this.ele.find("th")},this.init(),this.check(this.ele)}var $tab=$(".NUITableAjax");if($tab.length){Table.prototype={constructor:Table,createView:function(d){this.options.oTbody.html("");for(var curPage=d.currentPage,pageSize=d.pageSize,total=d.total,th=this.options.aTh,i=0;pageSize>i;i++){for(var $tr=$("<tr>"),str="",j=0,len=th.length;len>j;j++){var v=th.eq(j),filed=v.attr("data-filed"),format=v.attr("data-format"),$td=$("<td>");if(0==j&&v.find('input[type="checkbox"]').length)$td.html('<input type="checkbox" name="checkView">');else if(filed)$td.html(d.data[i][filed]);else if(format){var callback=eval(format);!function(t){t(d.data[i],$tr,$td)}(callback)}else $td.html(pageSize*(curPage-1)+i+1);$tr.append($td)}this.options.oTbody.append($tr)}},getData:function(){var t=this;$.ajax({type:"post",url:t.options.url,dataType:"json",success:function(e){t.createView(e);var a=$($(".NUIPages").length?".NUIPages":'<div class="NUIPages">');NUI.NUIPages(a,e.total,{success:function(e){t.createView(e)}},this.url),t.ele.after(a)}})},check:function(t){t.delegate("#SysCheckAll","click",function(){$eles=$("tbody input:checkbox"),$(this).prop("checked")?$eles.prop("checked",!0):$eles.prop("checked",!1)}),t.delegate("tbody input:checkbox","click",function(){var t=$("#SysCheckAll"),e=$("tbody input:checkbox"),a=e.length;if($(this).prop("checked"))for(var i,n=0;(i=e.eq(n++))&&i.prop("checked");)n==a&&t.prop("checked",!0);else t.prop("checked",!1)})},sort:function(){this.options.aTh.on("click",function(){var t=$(this).attr("data-sort");t&&$.ajax({type:"post",url:_self.options.url+t,dataType:"json",success:function(t){_self.createView(t);var e=$($(".NUIPages").length?".NUIPages":'<div class="NUIPages">');NUI.NUIPages(e,t.total,{success:function(t){_self.createView(t)}},this.url),_self.ele.after(e)}})})},init:function(){this.getData()}};var table=new Table($tab)}}),NUI.validate=function(){$(".NUIValidate").each(function(){var t=$(this);t.find("[datatype]").each(function(){var t="";t+='<div class="NUIValidInfo"><span class="NUIValidCheckTip"></span><span class="NUIValidDec"><s class="dec1">&#9670;</s><s class="dec2">&#9670;</s></span></div>',$(this).before(t)}),$(this).Validform({tiptype:function(t,e,a){if(e.obj.hasClass("NUISelect"))var i=e.obj.parent().prev().find(".NUIValidCheckTip");else var i=e.obj.prev().find(".NUIValidCheckTip");if(a(i,e.type),i.text(t),e.obj.hasClass("NUISelect"))var n=e.obj.parent().prev();else var n=e.obj.prev();if(2==e.type)n.fadeOut(200);else{if(n.is(":visible"))return;if(e.obj.hasClass("NUISelect")){var s=e.obj.parent().offset().left,l=e.obj.parent().offset().top,r=e.obj.parent().height();n.css({left:s,top:l-45}).show().animate({top:l+r+10},200)}else{var s=e.obj.offset().left,l=e.obj.offset().top,r=e.obj.height();n.css({left:s,top:l-45}).show().animate({top:l+r+10},200)}}}})})};var NUMREG=/^\d*$/,scan=NUI.$(function(){function createNUISelect(t,e){var a=t,i=a.children(),n=[];i.each(function(t){var e={};$(this).attr("selected")&&(e.active=!0),e.ID=$(this).val(),e.text=$(this).text(),n.push(e)});for(var s=a.attr("class").split(" "),l=[],r=0,o=s.length;o>r;r++)"NUISelect"!=s[r];if(html='<div class="NUISelectZoo '+l.join(" ")+'"></div>',a.before(html),a.prev().append(a),e){var c=NUI.$.extend({},e,{data:n});return void NUI.NUISelect(a.parent(),c)}NUI.NUISelect(a.parent(),{data:n})}NUI.validate(),$(".NUISelect").each(function(i){var options=$(this).attr("data-options");return options?(objOption=eval("("+options+")"),void createNUISelect($(this),objOption)):void createNUISelect($(this))}),$(".NUITab").each(function(t){if($(this).hasClass("NUITabAction")){var e=$(this),a=$(this).children(),i=e.next().children();a.each(function(t){if($that=$(this),$that.hasClass("active")){var e=$that.index();i.eq(e).show().siblings().hide()}})}}),$(".NUIPages").each(function(i){var $that=$(this),url=$that.attr("data-url"),total=NUI.trim($that.attr("data-total")),optionsPages=eval("("+$that.attr("data-options")+")");if(url&&(url=$.trim(url)),!url)throw Error("分页NUIPages样式增加未data-url属性(数据请求接口)");if(!total||!NUMREG.test(total))throw Error("分页NUIPages样式未添加或设置不正确data-total属性(数据总数目)");NUI.NUIPages($that,parseInt(total),optionsPages,url)}),$(".NUILinkage").each(function(index){var $that=$(this),urls=eval("("+$that.attr("data-url")+")"),names=eval("("+$that.attr("data-name")+")"),params=eval("("+$that.attr("data-parmas")+")"),optionsLink=eval("("+$that.attr("data-options")+")"),defaultVal=eval("("+$that.attr("data-defaultVal")+")");if(urls.length!=names.length||names.length!=params.length)throw Error("NUILinkage的urls数量和names以及params不一致,请注意");for(var len,i=0,len=urls.length;len>i;i++){var html="";html+='<select class="NUISelect" name="'+names[i]+'"></select>',$that.append(html);var $select=$that.children().eq(i),options=NUI.$.extend({},optionsLink);createNUISelect($select,options)}if(defaultVal&&defaultVal.length)for(var lj=0,len=defaultVal.length;len>lj;lj++){var k=params[lj],v=0==lj?params[0]:defaultVal[lj-1],data=0==lj?params[0]:{k:v};$.ajax({type:"post",url:urls[lj],data:data,async:!1,dataType:"json",success:function(t){if(!t.statu)throw Error("Linkage"+urls[0]+"返回数据:"+t.message);for(var t=t.Data,e="",a="",i=0,n=t.length;n>i;i++)t[i][optionsLink.ID]==defaultVal[lj]?(e+='<option value="'+t[i][optionsLink.ID]+'" selected="selected">'+t[i][optionsLink.value]+"</option>",a+='<li data-bind="'+t[i][optionsLink.ID]+'" class="active">'+t[i][optionsLink.value]+"</li>",$that.find(".NUISelectZoo").eq(lj).find(".NUISelectVal").text(t[i][optionsLink.value])):(e+='<option value="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</option>",a+='<li data-bind="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</li>");$that.find("select").eq(lj).append(e),$that.find(".NUISelectList").eq(lj).append(a)},error:function(){throw Error("Linkage"+urls[0]+"请求失败")}})}else NUI.$.ajax({type:"GET",url:urls[0],data:params[0],dataType:"json",async:!1,success:function(t){for(var t=t.Data,e="",a="",i=0,n=t.length;n>i;i++)e+='<option value="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</option>",a+='<li data-bind="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</li>";$that.find("select").eq(0).append(e),$that.find(".NUISelectList").eq(0).append(a)},error:function(){throw Error(urls[0]+" 请求失败")}});$that.children().on("click","li",function(){var t=$(this),e=t.attr("data-id"),a=$(this).parents().eq(2),i=a.index(),n=i+1;params[n];if(i<urls.length-1){for(;i<urls.length-1;i++)$that.find("select").eq(i+1).empty(),$that.find(".NUISelectList").eq(i+1).empty(),$that.find(".NUISelectZoo").eq(i+1).find(".NUISelectVal").text("请选择");$.ajax({type:"post",url:urls[n],data:{key:e},async:!1,dataType:"json",success:function(t){for(var t=t.Data,e="",a="",i=0,s=t.length;s>i;i++)e+='<option value="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</option>",a+='<li data-bind="'+t[i][optionsLink.ID]+'">'+t[i][optionsLink.value]+"</li>";$that.find("select").eq(n).append(e),$that.find(".NUISelectList").eq(n).append(a)},error:function(){}})}})}),$(".NUISearchAction").each(function(i){var $that=$(this),html="",option=eval("("+$that.attr("data-options")+")"),param=$that.attr("data-params"),url=$that.attr("data-url"),defaultVal=$that.attr("data-defaultVal"),$parent,$SearchList;if(!url||!param)throw Error("请参照用户手册绑定url和参数");for(var options=$.extend({IDField:"ID",textField:"value"},option),arrClass=$that.attr("class").split(" "),arrNClass=[],i=0,len=arrClass.length;len>i;i++)"NUISearchInput"!=arrClass[i]&&"NUISearchAction"!=arrClass[i]&&arrNClass.push(arrClass[i]);defaultVal&&$.trim(defaultVal)&&$that.val($.trim(defaultVal)),html='<div class="NUISearchtZoo '+arrNClass.join(" ")+'"></div>',$that.before(html),$that.prev().append($that),$parent=$that.parent(),$parent.append('<ul class="NUISelectList NUISearchList"></ul>'),$SearchList=$parent.find(".NUISearchList"),$that.on("keyup",function(){var t=$that.val(),e={param:t};$.trim(t)?NUI.ajax(url,!1,e).done(function(t){$SearchList.empty(),$SearchList.show();var t=t.Data,e="";if(t.length)for(var a=0,i=t.length;i>a;a++)e+='<li data-id="'+t[a][options.IDField]+'">'+t[a][options.textField]+"</li>";else e+='<p class="NUISearchNoData">未匹配数据</p>';$SearchList.append(e)}).fail(function(){throw Error(url+"接口异常")}):($SearchList.empty(),$SearchList.hide())}),$parent.on("click","li",function(){var t=$(this),e=t.text();return $that.val(e),$SearchList.empty(),$SearchList.hide(),!1})})})}(jQuery,document);